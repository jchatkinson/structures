<!-- saved from url=(0014)about:internet -->
<pre class="code">
<span class="srcline"><span class="lineno"><a href="1,1" id="srcline1"> 1</a></span><span class="line"><span class="keyword">function</span> [<span class="var type1" id="S2T5U3">Q</span>,<span class="var type1" id="S3T34U4">V</span>,<span class="var type1" id="S4T34U5">R</span>]=MSA(<span class="var type1" id="S5T1U8">m</span>,<span class="var type1" id="S6T1U9">n</span>,<span class="var type1" id="S7T9U10">DCon</span>,<span class="var type1" id="S8T10U11">DCoord</span>,<span class="var type1" id="S9T19U12">Dbe</span>,<span class="var type1" id="S10T19U13">DA</span>,<span class="var type1" id="S11T19U14">DIy</span>,<span class="var type1" id="S12T19U15">DIz</span>,<span class="var type1" id="S13T19U16">DG</span>,<span class="var type1" id="S14T19U17">DJ</span>,<span class="var type1" id="S15T19U18">DE</span>,<span class="var type1" id="S16T32U19">Dw</span>,<span class="var type1" id="S17T34U20">DSt</span>,<span class="var type1" id="S18T34U21">DRe</span>,<span class="var type1" id="S19T34U22">DLoad</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="1,2" id="srcline2"> 2</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,3" id="srcline3"> 3</a></span><span class="line"><span class="mxinfo" id="T37:U19"><span class="var type1" id="S20T37U25">Ni</span>=<span class="mxinfo" id="T37:U21">zeros(<span class="mxinfo" id="T2:U22">12</span>,<span class="mxinfo" id="T2:U23">12</span>,<span class="var type1" id="S5T1U30">m</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,4" id="srcline4"> 4</a></span><span class="line"><span class="mxinfo" id="T4:U25"><span class="var type1" id="S22T4U33">S</span>=<span class="mxinfo" id="T4:U27">zeros(<span class="mxinfo" id="T1:U28">6*<span class="var type1" id="S6T1U38">n</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,5" id="srcline5"> 5</a></span><span class="line"><span class="mxinfo" id="T19:U30"><span class="var type1" id="S23T19U41">Pf</span>=<span class="mxinfo" id="T19:U32"><span class="var type1" id="S22T4U43">S</span>(:,<span class="mxinfo" id="T2:U34">1</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,6" id="srcline6"> 6</a></span><span class="line"><span class="mxinfo" id="T5:U35"><span class="var type1" id="S2T5U48">Q</span>=<span class="mxinfo" id="T5:U37">zeros(<span class="mxinfo" id="T2:U38">12</span>,<span class="var type1" id="S5T1U52">m</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,7" id="srcline7"> 7</a></span><span class="line"><span class="mxinfo" id="T5:U40"><span class="var type1" id="S24T5U55">Qfi</span>=<span class="var type1" id="S2T5U56">Q</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,8" id="srcline8"> 8</a></span><span class="line"><span class="mxinfo" id="T5:U43"><span class="var type1" id="S25T5U59">Ei</span>=<span class="var type1" id="S2T5U60">Q</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,9" id="srcline9"> 9</a></span><span class="line"><span class="mxinfo" id="T1:U46"><span class="keyword">for</span> <span class="var type1" id="S26T1U63">i</span>=<span class="mxinfo" id="T1:U48">1</span>:<span class="var type1" id="S5T1U66">m</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,10" id="srcline10">10</a></span><span class="line"><span class="mxinfo" id="T1:U46">    <span class="mxinfo" id="T11:U50"><span class="var type1" id="S27T11U69">H</span>=<span class="mxinfo" id="T11:U52"><span class="var type1" id="S7T9U71">DCon</span>(:,<span class="var type1" id="S26T1U73">i</span>)</span></span>;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,11" id="srcline11">11</a></span><span class="line"><span class="mxinfo" id="T1:U46">    <span class="mxinfo" id="T20:U55"><span class="var type1" id="S28T20U76">C</span>=<span class="mxinfo" id="T20:U57"><span class="mxinfo" id="T20:U58"><span class="var type1" id="S8T10U79">DCoord</span>(:,<span class="mxinfo" id="T1:U60"><span class="var type1" id="S27T11U82">H</span>(<span class="mxinfo" id="T2:U62">2</span>)</span>)</span>-<span class="mxinfo" id="T20:U63"><span class="var type1" id="S8T10U85">DCoord</span>(:,<span class="mxinfo" id="T1:U65"><span class="var type1" id="S27T11U88">H</span>(<span class="mxinfo" id="T2:U67">1</span>)</span>)</span></span></span>;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,12" id="srcline12">12</a></span><span class="line"><span class="mxinfo" id="T1:U46">    <span class="mxinfo" id="T18:U68"><span class="var type1" id="S29T18U92">e</span>=<span class="mxinfo" id="T18:U70">[<span class="mxinfo" id="T18:U71"><span class="mxinfo" id="T1:U72"><span class="mxinfo" id="T1:U73">6*<span class="mxinfo" id="T1:U74"><span class="var type1" id="S27T11U100">H</span>(<span class="mxinfo" id="T2:U76">1</span>)</span></span>-<span class="mxinfo" id="T1:U77">5</span></span>:<span class="mxinfo" id="T1:U78">6*<span class="mxinfo" id="T1:U79"><span class="var type1" id="S27T11U106">H</span>(<span class="mxinfo" id="T2:U81">1</span>)</span></span></span>,<span class="mxinfo" id="T18:U82"><span class="mxinfo" id="T1:U83"><span class="mxinfo" id="T1:U84">6*<span class="mxinfo" id="T1:U85"><span class="var type1" id="S27T11U113">H</span>(<span class="mxinfo" id="T2:U87">2</span>)</span></span>-<span class="mxinfo" id="T1:U88">5</span></span>:<span class="mxinfo" id="T1:U89">6*<span class="mxinfo" id="T1:U90"><span class="var type1" id="S27T11U119">H</span>(<span class="mxinfo" id="T2:U92">2</span>)</span></span></span>]</span></span>;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,13" id="srcline13">13</a></span><span class="line"><span class="mxinfo" id="T1:U46">    <span class="mxinfo" id="T2:U93"><span class="var type1" id="S30T2U123">c</span>=<span class="mxinfo" id="T2:U95"><span class="var type1" id="S9T19U125">Dbe</span>(<span class="var type1" id="S26T1U126">i</span>)</span></span>;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,14" id="srcline14">14</a></span><span class="line"><span class="mxinfo" id="T1:U46">    <span class="mxinfo" id="T2:U98">[<span class="var type1" id="S31T2U130">a</span>,<span class="var type1" id="S32T2U131">b</span>,<span class="var type1" id="S33T2U132">L</span>]=cart2sph(<span class="mxinfo" id="T2:U102"><span class="var type1" id="S28T20U136">C</span>(<span class="mxinfo" id="T2:U104">1</span>)</span>,<span class="mxinfo" id="T2:U105"><span class="var type1" id="S28T20U139">C</span>(<span class="mxinfo" id="T2:U107">3</span>)</span>,<span class="mxinfo" id="T2:U108"><span class="var type1" id="S28T20U142">C</span>(<span class="mxinfo" id="T2:U110">2</span>)</span>)</span>;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,15" id="srcline15">15</a></span><span class="line"><span class="mxinfo" id="T1:U46">    <span class="mxinfo" id="T2:U111"><span class="var type1" id="S35T2U146">ca</span>=<span class="mxinfo" id="T2:U113">cos(<span class="var type1" id="S31T2U149">a</span>)</span></span>;<span class="mxinfo" id="T2:U115"><span class="var type1" id="S37T2U152">sa</span>=<span class="mxinfo" id="T2:U117">sin(<span class="var type1" id="S31T2U155">a</span>)</span></span>;<span class="mxinfo" id="T2:U119"><span class="var type1" id="S39T2U158">cb</span>=<span class="mxinfo" id="T2:U121">cos(<span class="var type1" id="S32T2U161">b</span>)</span></span>;<span class="mxinfo" id="T2:U123"><span class="var type1" id="S40T2U164">sb</span>=<span class="mxinfo" id="T2:U125">sin(<span class="var type1" id="S32T2U167">b</span>)</span></span>;<span class="mxinfo" id="T2:U127"><span class="var type1" id="S41T2U170">cc</span>=<span class="mxinfo" id="T2:U129">cos(<span class="var type1" id="S30T2U173">c</span>)</span></span>;<span class="mxinfo" id="T2:U131"><span class="var type1" id="S42T2U176">sc</span>=<span class="mxinfo" id="T2:U133">sin(<span class="var type1" id="S30T2U179">c</span>)</span></span>;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,16" id="srcline16">16</a></span><span class="line"><span class="mxinfo" id="T1:U46">    <span class="mxinfo" id="T23:U135"><span class="var type1" id="S43T23U182">r</span>=<span class="mxinfo" id="T23:U137"><span class="mxinfo" id="T23:U138"><span class="mxinfo" id="T23:U139">[<span class="mxinfo" id="T31:U140"><span class="mxinfo" id="T2:U141">1</span> <span class="mxinfo" id="T2:U142">0</span> <span class="mxinfo" id="T2:U143">0</span></span>;<span class="mxinfo" id="T31:U144"><span class="mxinfo" id="T2:U145">0</span> <span class="var type1" id="S41T2U192">cc</span> <span class="var type1" id="S42T2U193">sc</span></span>;<span class="mxinfo" id="T31:U148"><span class="mxinfo" id="T2:U149">0</span> <span class="mxinfo" id="T2:U150">-<span class="var type1" id="S42T2U197">sc</span></span> <span class="var type1" id="S41T2U198">cc</span></span>]</span>*<span class="mxinfo" id="T23:U153">[<span class="mxinfo" id="T31:U154"><span class="var type1" id="S39T2U201">cb</span> <span class="var type1" id="S40T2U202">sb</span> <span class="mxinfo" id="T2:U157">0</span></span>;<span class="mxinfo" id="T31:U158"><span class="mxinfo" id="T2:U159">-<span class="var type1" id="S40T2U206">sb</span></span> <span class="var type1" id="S39T2U207">cb</span> <span class="mxinfo" id="T2:U162">0</span></span>;<span class="mxinfo" id="T31:U163"><span class="mxinfo" id="T2:U164">0</span> <span class="mxinfo" id="T2:U165">0</span> <span class="mxinfo" id="T2:U166">1</span></span>]</span></span>*<span class="mxinfo" id="T23:U167">[<span class="mxinfo" id="T31:U168"><span class="var type1" id="S35T2U215">ca</span> <span class="mxinfo" id="T2:U170">0</span> <span class="var type1" id="S37T2U217">sa</span></span>;<span class="mxinfo" id="T31:U172"><span class="mxinfo" id="T2:U173">0</span> <span class="mxinfo" id="T2:U174">1</span> <span class="mxinfo" id="T2:U175">0</span></span>;<span class="mxinfo" id="T31:U176"><span class="mxinfo" id="T2:U177">-<span class="var type1" id="S37T2U224">sa</span></span> <span class="mxinfo" id="T2:U179">0</span> <span class="var type1" id="S35T2U226">ca</span></span>]</span></span></span>;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,17" id="srcline17">17</a></span><span class="line"><span class="mxinfo" id="T1:U46">    <span class="mxinfo" id="T27:U181"><span class="var type1" id="S44T27U229">T</span>=<span class="mxinfo" id="T27:U183">kron(<span class="mxinfo" id="T26:U184">eye(4)</span>,<span class="var type1" id="S43T23U235">r</span>)</span></span>;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,18" id="srcline18">18</a></span><span class="line"><span class="mxinfo" id="T1:U46">    <span class="mxinfo" id="T30:U186"><span class="var type1" id="S47T30U238">co</span>=<span class="mxinfo" id="T30:U188"><span class="mxinfo" id="T2:U189"><span class="mxinfo" id="T2:U190">2</span>*<span class="var type1" id="S33T2U242">L</span></span>*<span class="mxinfo" id="T30:U192">[<span class="mxinfo" id="T2:U193"><span class="mxinfo" id="T2:U194">6</span>/<span class="var type1" id="S33T2U247">L</span></span> <span class="mxinfo" id="T2:U196">3</span> <span class="mxinfo" id="T2:U197"><span class="mxinfo" id="T2:U198">2</span>*<span class="var type1" id="S33T2U251">L</span></span> <span class="var type1" id="S33T2U252">L</span>]</span></span></span>;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,19" id="srcline19">19</a></span><span class="line"><span class="mxinfo" id="T1:U46">    <span class="mxinfo" id="T2:U201"><span class="var type1" id="S48T2U255">x</span>=<span class="mxinfo" id="T2:U203"><span class="mxinfo" id="T2:U204"><span class="var type1" id="S10T19U258">DA</span>(<span class="var type1" id="S26T1U259">i</span>)</span>*<span class="mxinfo" id="T2:U207"><span class="var type1" id="S33T2U261">L</span>^2</span></span></span>;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,20" id="srcline20">20</a></span><span class="line"><span class="mxinfo" id="T1:U46">    <span class="mxinfo" id="T30:U209"><span class="var type1" id="S49T30U265">y</span>=<span class="mxinfo" id="T30:U211"><span class="mxinfo" id="T2:U212"><span class="var type1" id="S11T19U268">DIy</span>(<span class="var type1" id="S26T1U269">i</span>)</span>*<span class="var type1" id="S47T30U270">co</span></span></span>;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,21" id="srcline21">21</a></span><span class="line"><span class="mxinfo" id="T1:U46">    <span class="mxinfo" id="T30:U216"><span class="var type1" id="S50T30U273">z</span>=<span class="mxinfo" id="T30:U218"><span class="mxinfo" id="T2:U219"><span class="var type1" id="S12T19U276">DIz</span>(<span class="var type1" id="S26T1U277">i</span>)</span>*<span class="var type1" id="S47T30U278">co</span></span></span>;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,22" id="srcline22">22</a></span><span class="line"><span class="mxinfo" id="T1:U46">    <span class="mxinfo" id="T2:U223"><span class="var type1" id="S51T2U281">g</span>=<span class="mxinfo" id="T2:U225"><span class="mxinfo" id="T2:U226"><span class="mxinfo" id="T2:U227"><span class="mxinfo" id="T2:U228"><span class="var type1" id="S13T19U286">DG</span>(<span class="var type1" id="S26T1U287">i</span>)</span>*<span class="mxinfo" id="T2:U231"><span class="var type1" id="S14T19U289">DJ</span>(<span class="var type1" id="S26T1U290">i</span>)</span></span>*<span class="mxinfo" id="T2:U234"><span class="var type1" id="S33T2U292">L</span>^2</span></span>/<span class="mxinfo" id="T2:U236"><span class="var type1" id="S15T19U295">DE</span>(<span class="var type1" id="S26T1U296">i</span>)</span></span></span>;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,23" id="srcline23">23</a></span><span class="line"><span class="mxinfo" id="T1:U46">    <span class="mxinfo" id="T23:U239"><span class="var type1" id="S52T23U299">K1</span>=<span class="mxinfo" id="T23:U241">diag(<span class="mxinfo" id="T31:U242">[<span class="var type1" id="S48T2U304">x</span>,<span class="mxinfo" id="T2:U244"><span class="var type1" id="S50T30U306">z</span>(<span class="mxinfo" id="T2:U246">1</span>)</span>,<span class="mxinfo" id="T2:U247"><span class="var type1" id="S49T30U309">y</span>(<span class="mxinfo" id="T2:U249">1</span>)</span>]</span>)</span></span>;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,24" id="srcline24">24</a></span><span class="line"><span class="mxinfo" id="T1:U46">    <span class="mxinfo" id="T23:U250"><span class="var type1" id="S54T23U313">K2</span>=<span class="mxinfo" id="T23:U252">[<span class="mxinfo" id="T31:U253"><span class="mxinfo" id="T2:U254">0</span> <span class="mxinfo" id="T2:U255">0</span> <span class="mxinfo" id="T2:U256">0</span></span>;<span class="mxinfo" id="T31:U257"><span class="mxinfo" id="T2:U258">0</span> <span class="mxinfo" id="T2:U259">0</span> <span class="mxinfo" id="T2:U260"><span class="var type1" id="S50T30U323">z</span>(<span class="mxinfo" id="T2:U262">2</span>)</span></span>;<span class="mxinfo" id="T31:U263"><span class="mxinfo" id="T2:U264">0</span> <span class="mxinfo" id="T2:U265">-<span class="mxinfo" id="T2:U266"><span class="var type1" id="S49T30U329">y</span>(<span class="mxinfo" id="T2:U268">2</span>)</span></span> <span class="mxinfo" id="T2:U269">0</span></span>]</span></span>;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,25" id="srcline25">25</a></span><span class="line"><span class="mxinfo" id="T1:U46">    <span class="mxinfo" id="T23:U270"><span class="var type1" id="S55T23U334">K3</span>=<span class="mxinfo" id="T23:U272">diag(<span class="mxinfo" id="T31:U273">[<span class="var type1" id="S51T2U339">g</span>,<span class="mxinfo" id="T2:U275"><span class="var type1" id="S49T30U341">y</span>(<span class="mxinfo" id="T2:U277">3</span>)</span>,<span class="mxinfo" id="T2:U278"><span class="var type1" id="S50T30U344">z</span>(<span class="mxinfo" id="T2:U280">3</span>)</span>]</span>)</span></span>;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,26" id="srcline26">26</a></span><span class="line"><span class="mxinfo" id="T1:U46">    <span class="mxinfo" id="T23:U281"><span class="var type1" id="S56T23U348">K4</span>=<span class="mxinfo" id="T23:U283">diag(<span class="mxinfo" id="T31:U284">[<span class="mxinfo" id="T2:U285">-<span class="var type1" id="S51T2U354">g</span></span>,<span class="mxinfo" id="T2:U287"><span class="var type1" id="S49T30U356">y</span>(<span class="mxinfo" id="T2:U289">4</span>)</span>,<span class="mxinfo" id="T2:U290"><span class="var type1" id="S50T30U359">z</span>(<span class="mxinfo" id="T2:U292">4</span>)</span>]</span>)</span></span>;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,27" id="srcline27">27</a></span><span class="line"><span class="mxinfo" id="T1:U46">    <span class="mxinfo" id="T27:U293"><span class="var type1" id="S57T27U363">K</span>=<span class="mxinfo" id="T27:U295"><span class="mxinfo" id="T2:U296"><span class="mxinfo" id="T2:U297"><span class="var type1" id="S15T19U367">DE</span>(<span class="var type1" id="S26T1U368">i</span>)</span>/<span class="mxinfo" id="T2:U300"><span class="var type1" id="S33T2U370">L</span>^3</span></span>*<span class="mxinfo" id="T27:U302">[<span class="mxinfo" id="T51:U303"><span class="var type1" id="S52T23U374">K1</span> <span class="var type1" id="S54T23U375">K2</span> <span class="mxinfo" id="T23:U306">-<span class="var type1" id="S52T23U377">K1</span></span> <span class="var type1" id="S54T23U378">K2</span></span>;<span class="mxinfo" id="T51:U309"><span class="mxinfo" id="T23:U310"><span class="var type1" id="S54T23U381">K2</span>'</span> <span class="var type1" id="S55T23U382">K3</span> <span class="mxinfo" id="T23:U313">-<span class="mxinfo" id="T23:U314"><span class="var type1" id="S54T23U385">K2</span>'</span></span> <span class="var type1" id="S56T23U386">K4</span></span>;<span class="mxinfo" id="T51:U317"><span class="mxinfo" id="T23:U318">-<span class="var type1" id="S52T23U389">K1</span></span> <span class="mxinfo" id="T23:U320">-<span class="var type1" id="S54T23U391">K2</span></span> <span class="var type1" id="S52T23U392">K1</span> <span class="mxinfo" id="T23:U323">-<span class="var type1" id="S54T23U394">K2</span></span></span>;<span class="mxinfo" id="T51:U325"><span class="mxinfo" id="T23:U326"><span class="var type1" id="S54T23U397">K2</span>'</span> <span class="var type1" id="S56T23U398">K4</span> <span class="mxinfo" id="T23:U329">-<span class="mxinfo" id="T23:U330"><span class="var type1" id="S54T23U401">K2</span>'</span></span> <span class="var type1" id="S55T23U402">K3</span></span>]</span></span></span>;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,28" id="srcline28">28</a></span><span class="line"><span class="mxinfo" id="T1:U46">    <span class="mxinfo" id="T33:U333"><span class="var type1" id="S58T33U405">w</span>=<span class="mxinfo" id="T33:U335"><span class="mxinfo" id="T19:U336"><span class="var type1" id="S16T32U408">Dw</span>(:,<span class="var type1" id="S26T1U410">i</span>)</span>'</span></span>;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,29" id="srcline29">29</a></span><span class="line"><span class="mxinfo" id="T1:U46">    <span class="mxinfo" id="T19:U339"><span class="var type1" id="S59T19U413">Qf</span>=<span class="mxinfo" id="T19:U341"><span class="mxinfo" id="T2:U342"><span class="mxinfo" id="T2:U343">-<span class="mxinfo" id="T2:U344"><span class="var type1" id="S33T2U418">L</span>^2</span></span>/<span class="mxinfo" id="T2:U346">12</span></span>*<span class="mxinfo" id="T19:U347"><span class="mxinfo" id="T33:U348">[<span class="mxinfo" id="T33:U349"><span class="mxinfo" id="T33:U350"><span class="mxinfo" id="T2:U351">6</span>*<span class="var type1" id="S58T33U427">w</span></span>/<span class="var type1" id="S33T2U428">L</span></span> <span class="mxinfo" id="T2:U354">0</span> <span class="mxinfo" id="T2:U355">-<span class="mxinfo" id="T2:U356"><span class="var type1" id="S58T33U432">w</span>(<span class="mxinfo" id="T2:U358">3</span>)</span></span> <span class="mxinfo" id="T2:U359"><span class="var type1" id="S58T33U435">w</span>(<span class="mxinfo" id="T2:U361">2</span>)</span> <span class="mxinfo" id="T33:U362"><span class="mxinfo" id="T33:U363"><span class="mxinfo" id="T2:U364">6</span>*<span class="var type1" id="S58T33U440">w</span></span>/<span class="var type1" id="S33T2U441">L</span></span> <span class="mxinfo" id="T2:U367">0</span> <span class="mxinfo" id="T2:U368"><span class="var type1" id="S58T33U444">w</span>(<span class="mxinfo" id="T2:U370">3</span>)</span> <span class="mxinfo" id="T2:U371">-<span class="mxinfo" id="T2:U372"><span class="var type1" id="S58T33U448">w</span>(<span class="mxinfo" id="T2:U374">2</span>)</span></span>]</span>'</span></span></span>;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,30" id="srcline30">30</a></span><span class="line"><span class="mxinfo" id="T1:U46">    <span class="mxinfo" id="T35:U375"><span class="var type1" id="S60T35U452">Qfs</span>=<span class="mxinfo" id="T35:U377"><span class="mxinfo" id="T27:U378"><span class="var type1" id="S57T27U455">K</span>*<span class="var type1" id="S44T27U456">T</span></span>*<span class="mxinfo" id="T19:U381"><span class="mxinfo" id="T33:U382"><span class="var type1" id="S17T34U459">DSt</span>(<span class="var type1" id="S29T18U460">e</span>)</span>'</span></span></span>;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,31" id="srcline31">31</a></span><span class="line"><span class="mxinfo" id="T1:U46">    <span class="mxinfo" id="T23:U385"><span class="var type1" id="S61T23U463">A</span>=<span class="mxinfo" id="T23:U387">diag(<span class="mxinfo" id="T31:U388">[0 -0.5 -0.5]</span>)</span></span>;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,32" id="srcline32">32</a></span><span class="line"><span class="mxinfo" id="T1:U46">    <span class="mxinfo" id="T23:U389"><span class="var type1" id="S62T23U475">B</span> = <span class="mxinfo" id="T23:U391">zeros(<span class="mxinfo" id="T2:U392">3</span>)</span></span>;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,33" id="srcline33">33</a></span><span class="line"><span class="mxinfo" id="T1:U46">    <span class="mxinfo" id="T2:U393"><span class="mxinfo" id="T2:U394"><span class="var type1" id="S62T23U482">B</span>(<span class="mxinfo" id="T2:U396">2</span>,<span class="mxinfo" id="T2:U397">3</span>)</span>=<span class="mxinfo" id="T2:U398"><span class="mxinfo" id="T2:U399">1.5</span>/<span class="var type1" id="S33T2U487">L</span></span></span>;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,34" id="srcline34">34</a></span><span class="line"><span class="mxinfo" id="T1:U46">    <span class="mxinfo" id="T2:U401"><span class="mxinfo" id="T2:U402"><span class="var type1" id="S62T23U491">B</span>(<span class="mxinfo" id="T2:U404">3</span>,<span class="mxinfo" id="T2:U405">2</span>)</span>=<span class="mxinfo" id="T2:U406"><span class="mxinfo" id="T2:U407">-1.5</span>/<span class="var type1" id="S33T2U497">L</span></span></span>;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,35" id="srcline35">35</a></span><span class="line"><span class="mxinfo" id="T1:U46">    <span class="mxinfo" id="T23:U409"><span class="var type1" id="S63T23U500">W</span>=<span class="mxinfo" id="T23:U411">diag(<span class="mxinfo" id="T31:U412">[1,0,0]</span>)</span></span>;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,36" id="srcline36">36</a></span><span class="line"><span class="mxinfo" id="T1:U46">    <span class="mxinfo" id="T23:U413"><span class="var type1" id="S64T23U510">Z</span>=<span class="mxinfo" id="T23:U415">zeros(<span class="mxinfo" id="T2:U416">3</span>)</span></span>;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,37" id="srcline37">37</a></span><span class="line"><span class="mxinfo" id="T1:U46">    <span class="mxinfo" id="T27:U417"><span class="var type1" id="S65T27U516">M</span>=<span class="mxinfo" id="T27:U419">eye(12)</span></span>;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,38" id="srcline38">38</a></span><span class="line"><span class="mxinfo" id="T1:U46">    <span class="mxinfo" id="T31:U420"><span class="var type1" id="S66T31U522">p</span>=<span class="mxinfo" id="T31:U422">4:6</span></span>;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,39" id="srcline39">39</a></span><span class="line"><span class="mxinfo" id="T1:U46">    <span class="mxinfo" id="T31:U423"><span class="var type1" id="S67T31U528">q</span>=<span class="mxinfo" id="T31:U425">10:12</span></span>;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,40" id="srcline40">40</a></span><span class="line"><span class="mxinfo" id="T1:U46">    <span class="keyword">switch</span> <span class="mxinfo" id="T1:U426"><span class="mxinfo" id="T1:U427">2*<span class="mxinfo" id="T1:U428"><span class="var type1" id="S27T11U537">H</span>(<span class="mxinfo" id="T2:U430">3</span>)</span></span>+<span class="mxinfo" id="T1:U431"><span class="var type1" id="S27T11U540">H</span>(<span class="mxinfo" id="T2:U433">4</span>)</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,41" id="srcline41">41</a></span><span class="line"><span class="mxinfo" id="T1:U46">        <span class="keyword">case</span> <span class="mxinfo" id="T1:U434">0</span>;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,42" id="srcline42">42</a></span><span class="line"><span class="mxinfo" id="T1:U46">            <span class="mxinfo" id="T23:U435"><span class="var type1" id="S62T23U546">B</span>=<span class="mxinfo" id="T23:U437"><span class="mxinfo" id="T23:U438"><span class="mxinfo" id="T2:U439">2</span>*<span class="var type1" id="S62T23U550">B</span></span>/<span class="mxinfo" id="T2:U441">3</span></span></span>;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,43" id="srcline43">43</a></span><span class="line"><span class="mxinfo" id="T1:U46">            <span class="mxinfo" id="T52:U442"><span class="mxinfo" id="T52:U443"><span class="var type1" id="S65T27U555">M</span>(:,<span class="mxinfo" id="T53:U445">[<span class="var type1" id="S66T31U559">p</span>,<span class="var type1" id="S67T31U560">q</span>]</span>)</span>=<span class="mxinfo" id="T52:U448">[<span class="mxinfo" id="T54:U449"><span class="mxinfo" id="T23:U450">-<span class="var type1" id="S62T23U564">B</span></span> <span class="mxinfo" id="T23:U452">-<span class="var type1" id="S62T23U566">B</span></span></span>;<span class="mxinfo" id="T54:U454"><span class="var type1" id="S63T23U568">W</span> <span class="var type1" id="S64T23U569">Z</span></span>;<span class="mxinfo" id="T54:U457"><span class="var type1" id="S62T23U571">B</span> <span class="var type1" id="S62T23U572">B</span></span>;<span class="mxinfo" id="T54:U460"><span class="var type1" id="S64T23U574">Z</span> <span class="var type1" id="S63T23U575">W</span></span>]</span></span>;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,44" id="srcline44">44</a></span><span class="line"><span class="mxinfo" id="T1:U46">        <span class="keyword">case</span> <span class="mxinfo" id="T1:U463">1</span>;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,45" id="srcline45">45</a></span><span class="line"><span class="mxinfo" id="T1:U46">            <span class="mxinfo" id="T55:U464"><span class="mxinfo" id="T55:U465"><span class="var type1" id="S65T27U581">M</span>(:,<span class="var type1" id="S66T31U583">p</span>)</span>=<span class="mxinfo" id="T55:U468">[<span class="mxinfo" id="T23:U469">-<span class="var type1" id="S62T23U587">B</span></span>;<span class="var type1" id="S63T23U589">W</span>;<span class="var type1" id="S62T23U591">B</span>;<span class="var type1" id="S61T23U593">A</span>]</span></span>;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,46" id="srcline46">46</a></span><span class="line"><span class="mxinfo" id="T1:U46">        <span class="keyword">case</span> <span class="mxinfo" id="T1:U474">2</span>;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,47" id="srcline47">47</a></span><span class="line"><span class="mxinfo" id="T1:U46">            <span class="mxinfo" id="T55:U475"><span class="mxinfo" id="T55:U476"><span class="var type1" id="S65T27U599">M</span>(:,<span class="var type1" id="S67T31U601">q</span>)</span>=<span class="mxinfo" id="T55:U479">[<span class="mxinfo" id="T23:U480">-<span class="var type1" id="S62T23U605">B</span></span>;<span class="var type1" id="S61T23U607">A</span>;<span class="var type1" id="S62T23U609">B</span>;<span class="var type1" id="S63T23U611">W</span>]</span></span>;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,48" id="srcline48">48</a></span><span class="line"><span class="mxinfo" id="T1:U46">    <span class="keyword">end</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,49" id="srcline49">49</a></span><span class="line"><span class="mxinfo" id="T1:U46">    <span class="mxinfo" id="T27:U485"><span class="var type1" id="S57T27U614">K</span>=<span class="mxinfo" id="T27:U487"><span class="var type1" id="S65T27U616">M</span>*<span class="var type1" id="S57T27U617">K</span></span></span>;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,50" id="srcline50">50</a></span><span class="line"><span class="mxinfo" id="T1:U46">    <span class="mxinfo" id="T27:U490"><span class="mxinfo" id="T27:U491"><span class="var type1" id="S20T37U621">Ni</span>(:,:,<span class="var type1" id="S26T1U624">i</span>)</span>=<span class="mxinfo" id="T27:U494"><span class="var type1" id="S57T27U626">K</span>*<span class="var type1" id="S44T27U627">T</span></span></span>;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,51" id="srcline51">51</a></span><span class="line"><span class="mxinfo" id="T1:U46">    <span class="mxinfo" id="T4:U497"><span class="mxinfo" id="T4:U498"><span class="var type1" id="S22T4U631">S</span>(<span class="var type1" id="S29T18U632">e</span>,<span class="var type1" id="S29T18U633">e</span>)</span>=<span class="mxinfo" id="T27:U502"><span class="mxinfo" id="T4:U503"><span class="var type1" id="S22T4U636">S</span>(<span class="var type1" id="S29T18U637">e</span>,<span class="var type1" id="S29T18U638">e</span>)</span>+<span class="mxinfo" id="T27:U507"><span class="mxinfo" id="T27:U508"><span class="var type1" id="S44T27U641">T</span>'</span>*<span class="mxinfo" id="T27:U510"><span class="var type1" id="S20T37U643">Ni</span>(:,:,<span class="var type1" id="S26T1U646">i</span>)</span></span></span></span>;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,52" id="srcline52">52</a></span><span class="line"><span class="mxinfo" id="T1:U46">    <span class="mxinfo" id="T35:U513"><span class="mxinfo" id="T35:U514"><span class="var type1" id="S24T5U650">Qfi</span>(:,<span class="var type1" id="S26T1U652">i</span>)</span>=<span class="mxinfo" id="T35:U517"><span class="var type1" id="S65T27U654">M</span>*<span class="var type1" id="S59T19U655">Qf</span></span></span>;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,53" id="srcline53">53</a></span><span class="line"><span class="mxinfo" id="T1:U46">    <span class="mxinfo" id="T33:U520"><span class="mxinfo" id="T33:U521"><span class="var type1" id="S23T19U659">Pf</span>(<span class="var type1" id="S29T18U660">e</span>)</span>=<span class="mxinfo" id="T35:U524"><span class="mxinfo" id="T19:U525"><span class="var type1" id="S23T19U663">Pf</span>(<span class="var type1" id="S29T18U664">e</span>)</span>+<span class="mxinfo" id="T35:U528"><span class="mxinfo" id="T27:U529"><span class="mxinfo" id="T27:U530"><span class="var type1" id="S44T27U668">T</span>'</span>*<span class="var type1" id="S65T27U669">M</span></span>*(<span class="mxinfo" id="T35:U533"><span class="var type1" id="S59T19U672">Qf</span>+<span class="var type1" id="S60T35U673">Qfs</span></span>)</span></span></span>;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,54" id="srcline54">54</a></span><span class="line"><span class="mxinfo" id="T1:U46">    <span class="mxinfo" id="T35:U536"><span class="mxinfo" id="T35:U537"><span class="var type1" id="S25T5U677">Ei</span>(:,<span class="var type1" id="S26T1U679">i</span>)</span>=<span class="var type1" id="S29T18U680">e</span></span>;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,55" id="srcline55">55</a></span><span class="line"><span class="mxinfo" id="T1:U46"><span class="keyword">end</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,56" id="srcline56">56</a></span><span class="line"><span class="mxinfo" id="T34:U541"><span class="var type1" id="S3T34U683">V</span>=<span class="mxinfo" id="T34:U543"><span class="mxinfo" id="T2:U544">1</span>-(<span class="mxinfo" id="T56:U545"><span class="var type1" id="S18T34U688">DRe</span>|<span class="var type1" id="S17T34U689">DSt</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,57" id="srcline57">57</a></span><span class="line"><span class="mxinfo" id="T19:U548"><span class="var type1" id="S68T19U692">f</span>=<span class="mxinfo" id="T19:U550">find(<span class="var type1" id="S3T34U695">V</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,58" id="srcline58">58</a></span><span class="line"><span class="mxinfo" id="T19:U552"><span class="mxinfo" id="T19:U553"><span class="var type1" id="S3T34U699">V</span>(<span class="var type1" id="S68T19U700">f</span>)</span>=<span class="mxinfo" id="T19:U556"><span class="mxinfo" id="T4:U557"><span class="var type1" id="S22T4U703">S</span>(<span class="var type1" id="S68T19U704">f</span>,<span class="var type1" id="S68T19U705">f</span>)</span>\(<span class="mxinfo" id="T19:U561"><span class="mxinfo" id="T19:U562"><span class="var type1" id="S19T34U709">DLoad</span>(<span class="var type1" id="S68T19U710">f</span>)</span>-<span class="mxinfo" id="T19:U565"><span class="var type1" id="S23T19U712">Pf</span>(<span class="var type1" id="S68T19U713">f</span>)</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,59" id="srcline59">59</a></span><span class="line"><span class="mxinfo" id="T34:U568"><span class="var type1" id="S4T34U716">R</span>=<span class="mxinfo" id="T34:U570">reshape(<span class="mxinfo" id="T19:U571"><span class="mxinfo" id="T19:U572"><span class="var type1" id="S22T4U721">S</span>*<span class="mxinfo" id="T19:U574"><span class="var type1" id="S3T34U723">V</span>(:)</span></span>+<span class="var type1" id="S23T19U725">Pf</span></span>,6,<span class="var type1" id="S6T1U727">n</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,60" id="srcline60">60</a></span><span class="line"><span class="mxinfo" id="T19:U578"><span class="mxinfo" id="T19:U579"><span class="var type1" id="S4T34U731">R</span>(<span class="var type1" id="S68T19U732">f</span>)</span>=<span class="mxinfo" id="T2:U582">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,61" id="srcline61">61</a></span><span class="line"><span class="mxinfo" id="T34:U583"><span class="var type1" id="S3T34U736">V</span>=<span class="mxinfo" id="T34:U585"><span class="var type1" id="S3T34U738">V</span>+<span class="var type1" id="S17T34U739">DSt</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,62" id="srcline62">62</a></span><span class="line"><span class="mxinfo" id="T1:U588"><span class="keyword">for</span> <span class="var type1" id="S26T1U742">i</span>=<span class="mxinfo" id="T1:U590">1</span>:<span class="var type1" id="S5T1U745">m</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,63" id="srcline63">63</a></span><span class="line"><span class="mxinfo" id="T1:U588">    <span class="mxinfo" id="T35:U592"><span class="mxinfo" id="T35:U593"><span class="var type1" id="S2T5U749">Q</span>(:,<span class="var type1" id="S26T1U751">i</span>)</span>=<span class="mxinfo" id="T35:U596"><span class="mxinfo" id="T35:U597"><span class="mxinfo" id="T27:U598"><span class="var type1" id="S20T37U755">Ni</span>(:,:,<span class="var type1" id="S26T1U758">i</span>)</span>*<span class="mxinfo" id="T35:U601"><span class="var type1" id="S3T34U760">V</span>(<span class="mxinfo" id="T35:U603"><span class="var type1" id="S25T5U762">Ei</span>(:,<span class="var type1" id="S26T1U764">i</span>)</span>)</span></span>+<span class="mxinfo" id="T35:U606"><span class="var type1" id="S24T5U766">Qfi</span>(:,<span class="var type1" id="S26T1U768">i</span>)</span></span></span>;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,64" id="srcline64">64</a></span><span class="line"><span class="mxinfo" id="T1:U588"><span class="keyword"><span class="keyword">end</span></span></span></span></span>
</pre>
